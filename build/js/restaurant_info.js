var restaurant,newMap;document.addEventListener("DOMContentLoaded",function(e){initIndexedDB(),initMap(),registerServiceWorker()}),initMap=function(){fetchRestaurantFromURL(function(e,t){e?console.error(e):(self.newMap=L.map("map",{center:[t.latlng.lat,t.latlng.lng],zoom:16,scrollWheelZoom:!1}),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token=sk.eyJ1IjoiZGFueWRpYXoiLCJhIjoiY2pxcTJ1dmptMDgxODQzbHB2bDk2dzJneCJ9.KEjkkpXABSLv90wwi5fKuw",{mapboxToken:"<your MAPBOX API KEY HERE>",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(newMap),changeKeyboardBehaviorForMap(),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.newMap))})},changeKeyboardBehaviorForMap=function(){document.getElementById("map").setAttribute("tabindex","-1")},fetchRestaurantFromURL=function(r){if(self.restaurant)r(null,self.restaurant);else{var e=getParameterByName("id");e?DBHelper.fetchRestaurantById(e,function(e,t){(self.restaurant=t)?(fillRestaurantHTML(),r(null,t)):console.error(e)}):(error="No restaurant id in URL",r(error,null))}},createSources=function(e){var t=document.createElement("source");return t.media=e.media,t.srcset=e.srcset,t},fillRestaurantHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant;document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;var t=document.getElementById("restaurant-picture");e.sources.forEach(function(e){t.append(createSources(e))});var r=document.getElementById("restaurant-img");r.className="restaurant-img",r.src=DBHelper.imageUrlForRestaurant(e),r.alt=e.photographDescription,r.remove(),t.append(r),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()},fillRestaurantHoursHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var r in e){var n=document.createElement("tr"),a=document.createElement("td");a.innerHTML=r,n.appendChild(a);var o=document.createElement("td");o.innerHTML=e[r],n.appendChild(o),t.appendChild(n)}},fillReviewsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.reviews,t=document.getElementById("reviews-container"),r=document.createElement("h3");if(r.innerHTML="Reviews",t.appendChild(r),!e){var n=document.createElement("p");return n.innerHTML="No reviews yet!",void t.appendChild(n)}var a=document.getElementById("reviews-list");e.forEach(function(e){a.appendChild(createReviewHTML(e))}),t.appendChild(a)},createReviewHTML=function(e){var t=document.createElement("li"),r=document.createElement("h4");r.innerHTML=e.name,t.appendChild(r);var n=document.createElement("p");n.innerHTML=e.date,t.appendChild(n);var a=document.createElement("p");a.innerHTML="Rating: ".concat(e.rating),t.appendChild(a);var o=document.createElement("p");return o.innerHTML=e.comments,t.appendChild(o),t},fillBreadcrumb=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("breadcrumb"),r=document.createElement("li"),n=document.createElement("a");n.href="/restaurant.html?id="+e.id,n.innerHTML=e.name,n.setAttribute("aria-current","page"),r.appendChild(n),t.appendChild(r)},getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]".concat(e,"(=([^&#]*)|&|#|$)")).exec(t);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null},registerServiceWorker=function(){navigator.serviceWorker&&navigator.serviceWorker.register("/service_worker.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)}).catch(function(e){console.log("Error registering service worker")})},initIndexedDB=function(){IndexedDatabase.openAndConfigureDatabase()};