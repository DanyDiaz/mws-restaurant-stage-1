function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var restaurantsdb,IndexedDatabase=function(){function l(){_classCallCheck(this,l)}return _createClass(l,null,[{key:"getRestaurantsInformation",value:function(){return restaurantsdb?new Promise(function(n,r){restaurantsdb.then(function(e){var t=e.transaction(l.restaurantsObjectStoreName,"readonly").objectStore(l.restaurantsObjectStoreName).getAll();t.onsuccess=function(e){n(e.target.result)},t.onerror=function(){r("Error counting messages in objectStore: "+l.restaurantsObjectStoreName)}})}):Promise.resolve(null)}},{key:"pushRestaurantsInformation",value:function(i){restaurantsdb&&restaurantsdb.then(function(e){var t=e.transaction(l.restaurantsObjectStoreName,"readwrite").objectStore(l.restaurantsObjectStoreName),n=!0,r=!1,a=void 0;try{for(var u,o=i[Symbol.iterator]();!(n=(u=o.next()).done);n=!0){var s=u.value;t.put(s)}}catch(e){r=!0,a=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}})}},{key:"openAndConfigureDatabase",value:function(){restaurantsdb=this.openIndexedDatabase(l.databaseName,l.currentDbVersion,function(e){e.createObjectStore(l.restaurantsObjectStoreName,{keyPath:"id"})})}},{key:"openIndexedDatabase",value:function(r,a,u){return window.indexedDB?new Promise(function(e,t){var n=indexedDB.open(r,a);n.onerror=function(e){t("Error at opening database: "+r+", error: "+e)},n.onupgradeneeded=function(e){u(e.target.result)},n.onsuccess=function(){e(this.result)}}):Promise.resolve(null)}},{key:"databaseName",get:function(){return"restaurantApp"}},{key:"currentDbVersion",get:function(){return 1}},{key:"restaurantsObjectStoreName",get:function(){return"restaurants"}}]),l}(),DBHelper=function(){function o(){_classCallCheck(this,o)}return _createClass(o,null,[{key:"fetchRestaurants",value:function(n){IndexedDatabase.getRestaurantsInformation().then(function(e){!e||e.length<=0?fetch(o.DATABASE_URL).then(function(e){if(!e.ok)throw Error(e.statusText);return e.json()}).then(function(e){n(null,e),IndexedDatabase.pushRestaurantsInformation(e)}).catch(function(e){var t="Request failed. Returned status of ".concat(e);n(t,null)}):n(null,e)})}},{key:"fetchRestaurantById",value:function(r,a){o.fetchRestaurants(function(e,t){if(e)a(e,null);else{var n=t.find(function(e){return e.id==r});n?a(null,n):a("Restaurant does not exist",null)}})}},{key:"fetchRestaurantByCuisine",value:function(r,a){o.fetchRestaurants(function(e,t){if(e)a(e,null);else{var n=t.filter(function(e){return e.cuisine_type==r});a(null,n)}})}},{key:"fetchRestaurantByNeighborhood",value:function(r,a){o.fetchRestaurants(function(e,t){if(e)a(e,null);else{var n=t.filter(function(e){return e.neighborhood==r});a(null,n)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(r,a,u){o.fetchRestaurants(function(e,t){if(e)u(e,null);else{var n=t;"all"!=r&&(n=n.filter(function(e){return e.cuisine_type==r})),"all"!=a&&(n=n.filter(function(e){return e.neighborhood==a})),u(null,n)}})}},{key:"fetchNeighborhoods",value:function(a){o.fetchRestaurants(function(e,n){if(e)a(e,null);else{var r=n.map(function(e,t){return n[t].neighborhood}),t=r.filter(function(e,t){return r.indexOf(e)==t});a(null,t)}})}},{key:"fetchCuisines",value:function(a){o.fetchRestaurants(function(e,n){if(e)a(e,null);else{var r=n.map(function(e,t){return n[t].cuisine_type}),t=r.filter(function(e,t){return r.indexOf(e)==t});a(null,t)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id=".concat(e.id)}},{key:"imageUrlForRestaurant",value:function(e){return"/img/".concat(e.photograph)}},{key:"mapMarkerForRestaurant",value:function(e,t){var n=new L.marker([e.latlng.lat,e.latlng.lng],{title:e.name,alt:e.name+" restaurant",url:o.urlForRestaurant(e)});return n.addTo(newMap),n}},{key:"DATABASE_URL",get:function(){return"http://localhost:".concat(1337,"/restaurants")}}]),o}();